{"version":3,"sources":["../src/models/security/proof-key.ts","../src/authentication/pop-crypto-provider.ts","../src/endpoints/xbox-endpoints.ts","../src/util/xbox-auth-constants.ts","../src/util/base64-encoder.ts","../src/converters/single-or-array.ts","../src/authentication/xbox-authentication-client.ts","../src/models/security/oauth-token.ts","../src/models/security/xbox-ticket.ts","../src/models/security/sisu-responses.ts"],"names":["webcrypto"],"mappings":"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","file":"index.mjs","sourcesContent":["/**\n * Represents an Elliptic Curve proof key in JWK (JSON Web Key) format.\n * Used for Proof-of-Possession (PoP) authentication with Xbox Live services.\n */\nexport interface ProofKey {\n  /**\n   * Key type. Always 'EC' for Elliptic Curve.\n   */\n  readonly kty: 'EC';\n\n  /**\n   * Algorithm. Always 'ES256' (ECDSA using P-256 and SHA-256).\n   */\n  readonly alg: 'ES256';\n\n  /**\n   * Curve identifier. Always 'P-256' (NIST P-256 curve).\n   */\n  readonly crv: 'P-256';\n\n  /**\n   * Key use. Always 'sig' for signing.\n   */\n  readonly use: 'sig';\n\n  /**\n   * X coordinate of the public key point, Base64URL encoded.\n   */\n  readonly x: string;\n\n  /**\n   * Y coordinate of the public key point, Base64URL encoded.\n   */\n  readonly y: string;\n}\n\n/**\n * Creates a ProofKey object from JWK X and Y coordinates.\n * @param x - X coordinate, Base64URL encoded.\n * @param y - Y coordinate, Base64URL encoded.\n * @returns A ProofKey object.\n */\nexport function createProofKey(x: string, y: string): ProofKey {\n  return {\n    kty: 'EC',\n    alg: 'ES256',\n    crv: 'P-256',\n    use: 'sig',\n    x,\n    y,\n  };\n}\n","import { webcrypto } from 'crypto';\nimport { createProofKey, type ProofKey } from '../models/security/proof-key.js';\n\ntype CryptoKey = webcrypto.CryptoKey;\n\ninterface ECKeyPair {\n  publicKey: CryptoKey;\n  privateKey: CryptoKey;\n}\n\n/**\n * Interface for Proof-of-Possession cryptographic providers.\n */\nexport interface IPoPCryptoProvider {\n  /**\n   * Gets the proof key containing the public key parameters.\n   */\n  getProofKey(): Promise<ProofKey>;\n\n  /**\n   * Signs data using the private key.\n   * @param data - The data to sign.\n   * @returns The ECDSA signature (IEEE P1363 format, 64 bytes for P-256).\n   */\n  sign(data: Uint8Array): Promise<Uint8Array>;\n}\n\n/**\n * ECDSA P-256 based Proof-of-Possession cryptographic provider.\n * Generates an ephemeral EC key pair and provides signing capabilities.\n */\nexport class ECDsaPoPCryptoProvider implements IPoPCryptoProvider {\n  private keyPair: ECKeyPair | null = null;\n  private proofKey: ProofKey | null = null;\n\n  /**\n   * Gets or generates the proof key containing the public key parameters.\n   * The key is lazily generated on first access.\n   * @returns A ProofKey object with the public key's X and Y coordinates.\n   */\n  async getProofKey(): Promise<ProofKey> {\n    if (this.proofKey === null) {\n      await this.ensureKeyPair();\n    }\n    return this.proofKey!;\n  }\n\n  /**\n   * Signs data using the ECDSA private key with SHA-256.\n   * @param data - The data to sign.\n   * @returns The signature in IEEE P1363 format (r || s, 64 bytes total).\n   */\n  async sign(data: Uint8Array): Promise<Uint8Array> {\n    await this.ensureKeyPair();\n\n    const signature = await webcrypto.subtle.sign(\n      { name: 'ECDSA', hash: 'SHA-256' },\n      this.keyPair!.privateKey,\n      data\n    );\n\n    return new Uint8Array(signature);\n  }\n\n  /**\n   * Ensures the key pair is generated. Generates a new P-256 key pair if not already present.\n   */\n  private async ensureKeyPair(): Promise<void> {\n    if (this.keyPair !== null) {\n      return;\n    }\n\n    this.keyPair = (await webcrypto.subtle.generateKey(\n      { name: 'ECDSA', namedCurve: 'P-256' },\n      true,\n      ['sign', 'verify']\n    )) as ECKeyPair;\n\n    const jwk = await webcrypto.subtle.exportKey('jwk', this.keyPair.publicKey);\n\n    if (!jwk.x || !jwk.y) {\n      throw new Error('Failed to export public key coordinates');\n    }\n\n    this.proofKey = createProofKey(jwk.x, jwk.y);\n  }\n}\n","/**\n * Xbox Live API endpoints for authentication and authorization.\n */\nexport const XboxEndpoints = {\n  /**\n   * OAuth 2.0 authorization endpoint (Microsoft login).\n   */\n  XboxLiveAuthorize: 'https://login.live.com/oauth20_authorize.srf',\n\n  /**\n   * OAuth 2.0 token endpoint (Microsoft login).\n   */\n  XboxLiveToken: 'https://login.live.com/oauth20_token.srf',\n\n  /**\n   * Auth relying party identifier.\n   */\n  XboxLiveAuthRelyingParty: 'http://auth.xboxlive.com',\n\n  /**\n   * User authentication endpoint.\n   */\n  XboxLiveUserAuthenticate: 'https://user.auth.xboxlive.com/user/authenticate',\n\n  /**\n   * Standard Xbox Live relying party identifier.\n   */\n  XboxLiveRelyingParty: 'http://xboxlive.com',\n\n  /**\n   * XSTS token authorization endpoint.\n   */\n  XboxLiveXstsAuthorize: 'https://xsts.auth.xboxlive.com/xsts/authorize',\n\n  /**\n   * Device authentication endpoint (requires PoP signature).\n   */\n  XboxLiveDeviceAuthenticate: 'https://device.auth.xboxlive.com/device/authenticate',\n\n  /**\n   * SISU authentication endpoint (session initialization).\n   */\n  XboxLiveSisuAuthenticate: 'https://sisu.xboxlive.com/authenticate',\n\n  /**\n   * SISU authorization endpoint (token acquisition).\n   */\n  XboxLiveSisuAuthorize: 'https://sisu.xboxlive.com/authorize',\n} as const;\n\nexport type XboxEndpoint = (typeof XboxEndpoints)[keyof typeof XboxEndpoints];\n","/**\n * Default authentication scopes for Xbox Live.\n */\nexport const DEFAULT_AUTH_SCOPES: readonly string[] = [\n  'Xboxlive.signin',\n  'Xboxlive.offline_access',\n] as const;\n\n/**\n * Additional scope for device authentication with MBI_SSL.\n */\nexport const DEVICE_AUTH_SCOPE = 'service::user.auth.xboxlive.com::MBI_SSL';\n\n/**\n * Default sandbox identifier.\n */\nexport const DEFAULT_SANDBOX = 'RETAIL';\n\n/**\n * Default token type for Xbox authentication requests.\n */\nexport const DEFAULT_TOKEN_TYPE = 'JWT';\n\n/**\n * Xbox Live contract version for user/XSTS endpoints.\n */\nexport const CONTRACT_VERSION_V1 = '1';\n\n/**\n * Xbox Live contract version for device/SISU endpoints.\n */\nexport const CONTRACT_VERSION_V2 = '2';\n\n/**\n * Policy version for request signing.\n */\nexport const SIGNING_POLICY_VERSION = 1;\n","/**\n * URL-safe Base64 encoding utilities (RFC 4648 Section 5).\n * Uses the alphabet: A-Z, a-z, 0-9, -, _ (no padding).\n */\n\n/**\n * Encodes a Uint8Array to URL-safe Base64 string (no padding).\n * @param data - The data to encode.\n * @returns URL-safe Base64 encoded string.\n */\nexport function base64UrlEncode(data: Uint8Array): string {\n  return Buffer.from(data).toString('base64url');\n}\n\n/**\n * Encodes a portion of a Uint8Array to URL-safe Base64 string.\n * @param data - The data to encode.\n * @param offset - Starting offset in the array.\n * @param length - Number of bytes to encode.\n * @returns URL-safe Base64 encoded string.\n */\nexport function base64UrlEncodeSubarray(\n  data: Uint8Array,\n  offset: number,\n  length: number\n): string {\n  return Buffer.from(data.slice(offset, offset + length)).toString('base64url');\n}\n\n/**\n * Decodes a URL-safe Base64 string to Uint8Array.\n * @param encoded - The URL-safe Base64 encoded string.\n * @returns Decoded data as Uint8Array.\n */\nexport function base64UrlDecode(encoded: string): Uint8Array {\n  return new Uint8Array(Buffer.from(encoded, 'base64url'));\n}\n\n/**\n * Encodes a Uint8Array to standard Base64 string.\n * @param data - The data to encode.\n * @returns Standard Base64 encoded string.\n */\nexport function base64Encode(data: Uint8Array): string {\n  return Buffer.from(data).toString('base64');\n}\n\n/**\n * Decodes a standard Base64 string to Uint8Array.\n * @param encoded - The Base64 encoded string.\n * @returns Decoded data as Uint8Array.\n */\nexport function base64Decode(encoded: string): Uint8Array {\n  return new Uint8Array(Buffer.from(encoded, 'base64'));\n}\n","/**\n * Normalizes a value that may be a single item or an array to always be an array.\n * This handles API responses where a field may return either a single object or an array.\n *\n * @param value - The value to normalize (single item, array, null, or undefined).\n * @returns An array containing the item(s), or an empty array if the value is null/undefined.\n *\n * @example\n * normalizeToArray({ id: 1 }); // [{ id: 1 }]\n * normalizeToArray([{ id: 1 }, { id: 2 }]); // [{ id: 1 }, { id: 2 }]\n * normalizeToArray(null); // []\n * normalizeToArray(undefined); // []\n */\nexport function normalizeToArray<T>(value: T | T[] | null | undefined): T[] {\n  if (value === null || value === undefined) {\n    return [];\n  }\n  return Array.isArray(value) ? value : [value];\n}\n\n/**\n * Normalizes Xbox display claims to ensure xui is always an array.\n * Xbox APIs may return xui as a single object or an array depending on the request.\n *\n * @param claims - The raw display claims from the API.\n * @returns Normalized claims with xui as an array.\n */\nexport function normalizeDisplayClaims<T extends { xui?: unknown }>(\n  claims: T | null | undefined\n): (Omit<T, 'xui'> & { xui: T extends { xui?: infer U } ? (U extends unknown[] ? U : U[]) : never }) | null {\n  if (claims === null || claims === undefined) {\n    return null;\n  }\n\n  return {\n    ...claims,\n    xui: normalizeToArray(claims.xui),\n  } as Omit<T, 'xui'> & { xui: T extends { xui?: infer U } ? (U extends unknown[] ? U : U[]) : never };\n}\n","import { createHash, randomBytes, webcrypto } from 'crypto';\nimport { ECDsaPoPCryptoProvider, type IPoPCryptoProvider } from './pop-crypto-provider.js';\nimport { XboxEndpoints } from '../endpoints/xbox-endpoints.js';\nimport {\n  DEFAULT_AUTH_SCOPES,\n  DEFAULT_SANDBOX,\n  DEFAULT_TOKEN_TYPE,\n  CONTRACT_VERSION_V1,\n  CONTRACT_VERSION_V2,\n  SIGNING_POLICY_VERSION,\n} from '../util/xbox-auth-constants.js';\nimport { base64Encode, base64UrlEncode } from '../util/base64-encoder.js';\nimport { normalizeToArray } from '../converters/single-or-array.js';\nimport type { OAuthToken } from '../models/security/oauth-token.js';\nimport type { XboxTicket, XboxDisplayClaims } from '../models/security/xbox-ticket.js';\nimport type { XboxTicketRequest, XboxTicketProperties } from '../models/security/xbox-ticket-request.js';\nimport type { SISUAuthenticationResponse, SISUAuthorizationResponse } from '../models/security/sisu-responses.js';\n\n/**\n * Options for creating an XboxAuthenticationClient.\n */\nexport interface XboxAuthenticationClientOptions {\n  /**\n   * Custom fetch function. Defaults to global fetch.\n   */\n  fetch?: typeof globalThis.fetch;\n\n  /**\n   * Custom Proof-of-Possession crypto provider.\n   */\n  popCryptoProvider?: IPoPCryptoProvider;\n}\n\n/**\n * Xbox Live authentication client.\n *\n * Provides methods for OAuth 2.0 authentication, Xbox Live user tokens,\n * device tokens with Proof-of-Possession, XSTS tokens, and SISU authentication.\n *\n * @example\n * ```typescript\n * const client = new XboxAuthenticationClient();\n *\n * // Generate OAuth authorization URL\n * const authUrl = client.generateAuthUrl('your-client-id', 'https://localhost/callback');\n *\n * // After user authorizes, exchange code for token\n * const oauthToken = await client.requestOAuthToken('your-client-id', authCode, 'https://localhost/callback');\n *\n * // Get user token\n * const userTicket = await client.requestUserToken(oauthToken.access_token!);\n *\n * // Get XSTS token\n * const xstsTicket = await client.requestXstsToken(userTicket.Token!);\n *\n * // Format for Xbox Live API calls\n * const authHeader = client.getXboxLiveV3Token(userTicket.DisplayClaims!.xui![0].uhs!, xstsTicket.Token!);\n * ```\n */\nexport class XboxAuthenticationClient {\n  private readonly popCryptoProvider: IPoPCryptoProvider;\n  private readonly fetchFn: typeof globalThis.fetch;\n  private readonly codeVerifier: string;\n  private readonly codeChallenge: string;\n\n  /**\n   * Creates a new Xbox authentication client.\n   * @param options - Configuration options.\n   */\n  constructor(options: XboxAuthenticationClientOptions = {}) {\n    this.popCryptoProvider = options.popCryptoProvider ?? new ECDsaPoPCryptoProvider();\n    this.fetchFn = options.fetch ?? globalThis.fetch;\n    this.codeVerifier = this.generateCodeVerifier();\n    this.codeChallenge = this.generateCodeChallenge(this.codeVerifier);\n  }\n\n  // ============================================================================\n  // OAuth Methods\n  // ============================================================================\n\n  /**\n   * Generates an OAuth 2.0 authorization URL for Microsoft login.\n   *\n   * @param clientId - The application's client ID.\n   * @param redirectUrl - The redirect URL after authorization.\n   * @param scopes - OAuth scopes. Defaults to Xbox Live signin scopes.\n   * @param state - Optional state parameter for CSRF protection.\n   * @returns The authorization URL to redirect the user to.\n   */\n  generateAuthUrl(\n    clientId: string,\n    redirectUrl: string,\n    scopes: readonly string[] = DEFAULT_AUTH_SCOPES,\n    state?: string\n  ): string {\n    const url = new URL(XboxEndpoints.XboxLiveAuthorize);\n    url.searchParams.set('client_id', clientId);\n    url.searchParams.set('response_type', 'code');\n    url.searchParams.set('approval_prompt', 'auto');\n    url.searchParams.set('scope', scopes.join(' '));\n    url.searchParams.set('redirect_uri', redirectUrl);\n    url.searchParams.set('code_challenge', this.codeChallenge);\n    url.searchParams.set('code_challenge_method', 'S256');\n\n    if (state !== undefined) {\n      url.searchParams.set('state', state);\n    }\n\n    return url.toString();\n  }\n\n  /**\n   * Exchanges an authorization code for OAuth tokens.\n   *\n   * @param clientId - The application's client ID.\n   * @param authorizationCode - The authorization code from the redirect.\n   * @param redirectUrl - The redirect URL (must match the one used for authorization).\n   * @param clientSecret - Optional client secret for confidential clients.\n   * @param scopes - OAuth scopes.\n   * @param useCodeVerifier - Whether to include the PKCE code verifier.\n   * @param signal - Optional AbortSignal for cancellation.\n   * @returns The OAuth token response, or null on failure.\n   */\n  async requestOAuthToken(\n    clientId: string,\n    authorizationCode: string,\n    redirectUrl: string,\n    clientSecret?: string,\n    scopes: readonly string[] = DEFAULT_AUTH_SCOPES,\n    useCodeVerifier = true,\n    signal?: AbortSignal\n  ): Promise<OAuthToken | null> {\n    const params = new URLSearchParams();\n    params.set('grant_type', 'authorization_code');\n    params.set('code', authorizationCode);\n    params.set('scope', scopes.join(' '));\n    params.set('redirect_uri', redirectUrl);\n    params.set('client_id', clientId);\n\n    if (clientSecret !== undefined) {\n      params.set('client_secret', clientSecret);\n    }\n\n    if (useCodeVerifier) {\n      params.set('code_verifier', this.codeVerifier);\n    }\n\n    const response = await this.fetchFn(XboxEndpoints.XboxLiveToken, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params.toString(),\n      signal,\n    });\n\n    if (!response.ok) {\n      return null;\n    }\n\n    return response.json() as Promise<OAuthToken>;\n  }\n\n  /**\n   * Refreshes an OAuth access token using a refresh token.\n   *\n   * @param clientId - The application's client ID.\n   * @param refreshToken - The refresh token.\n   * @param redirectUrl - The redirect URL.\n   * @param clientSecret - Optional client secret for confidential clients.\n   * @param scopes - OAuth scopes.\n   * @param signal - Optional AbortSignal for cancellation.\n   * @returns The new OAuth token response, or null on failure.\n   */\n  async refreshOAuthToken(\n    clientId: string,\n    refreshToken: string,\n    redirectUrl: string,\n    clientSecret?: string,\n    scopes: readonly string[] = DEFAULT_AUTH_SCOPES,\n    signal?: AbortSignal\n  ): Promise<OAuthToken | null> {\n    const params = new URLSearchParams();\n    params.set('grant_type', 'refresh_token');\n    params.set('refresh_token', refreshToken);\n    params.set('scope', scopes.join(' '));\n    params.set('redirect_uri', redirectUrl);\n    params.set('client_id', clientId);\n\n    if (clientSecret !== undefined) {\n      params.set('client_secret', clientSecret);\n    }\n\n    const response = await this.fetchFn(XboxEndpoints.XboxLiveToken, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params.toString(),\n      signal,\n    });\n\n    if (!response.ok) {\n      return null;\n    }\n\n    return response.json() as Promise<OAuthToken>;\n  }\n\n  // ============================================================================\n  // User Token Methods\n  // ============================================================================\n\n  /**\n   * Requests a user authentication token from Xbox Live.\n   *\n   * @param accessToken - The OAuth access token.\n   * @param signal - Optional AbortSignal for cancellation.\n   * @returns The Xbox user ticket, or null on failure.\n   */\n  async requestUserToken(accessToken: string, signal?: AbortSignal): Promise<XboxTicket | null> {\n    const request: XboxTicketRequest = {\n      RelyingParty: XboxEndpoints.XboxLiveAuthRelyingParty,\n      TokenType: DEFAULT_TOKEN_TYPE,\n      Properties: {\n        AuthMethod: 'RPS',\n        SiteName: 'user.auth.xboxlive.com',\n        RpsTicket: `d=${accessToken}`,\n      },\n    };\n\n    const response = await this.fetchFn(XboxEndpoints.XboxLiveUserAuthenticate, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-xbl-contract-version': CONTRACT_VERSION_V1,\n        Accept: 'application/json',\n      },\n      body: JSON.stringify(request),\n      signal,\n    });\n\n    if (!response.ok) {\n      return null;\n    }\n\n    const ticket = (await response.json()) as XboxTicket;\n    return this.normalizeTicketClaims(ticket);\n  }\n\n  /**\n   * Formats an Xbox Live 3.0 authorization header value.\n   *\n   * @param userHash - The user hash from the user token's display claims.\n   * @param userToken - The XSTS token value.\n   * @returns The formatted authorization header value.\n   */\n  getXboxLiveV3Token(userHash: string, userToken: string): string {\n    return `XBL3.0 x=${userHash};${userToken}`;\n  }\n\n  // ============================================================================\n  // Device Token Methods\n  // ============================================================================\n\n  /**\n   * Requests a device authentication token with Proof-of-Possession signature.\n   *\n   * @param deviceType - Device type (e.g., 'Win32', 'Android', 'iOS').\n   * @param version - Device/OS version string.\n   * @param authMethod - Authentication method (typically 'ProofOfPossession').\n   * @param signal - Optional AbortSignal for cancellation.\n   * @returns The Xbox device ticket, or null on failure.\n   */\n  async requestDeviceToken(\n    deviceType = 'Win32',\n    version = '10.0.22000',\n    authMethod = 'ProofOfPossession',\n    signal?: AbortSignal\n  ): Promise<XboxTicket | null> {\n    const deviceId = `{${webcrypto.randomUUID().toUpperCase()}}`;\n    const proofKey = await this.popCryptoProvider.getProofKey();\n\n    const request: XboxTicketRequest = {\n      RelyingParty: XboxEndpoints.XboxLiveAuthRelyingParty,\n      TokenType: DEFAULT_TOKEN_TYPE,\n      Properties: {\n        AuthMethod: authMethod,\n        DeviceType: deviceType,\n        Id: deviceId,\n        ProofKey: proofKey,\n        Version: version,\n      },\n    };\n\n    const body = JSON.stringify(request);\n    const signature = await this.signRequest(\n      XboxEndpoints.XboxLiveDeviceAuthenticate,\n      '',\n      body\n    );\n\n    const response = await this.fetchFn(XboxEndpoints.XboxLiveDeviceAuthenticate, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        Signature: signature,\n        'x-xbl-contract-version': CONTRACT_VERSION_V2,\n      },\n      body,\n      signal,\n    });\n\n    if (!response.ok) {\n      return null;\n    }\n\n    const ticket = (await response.json()) as XboxTicket;\n    return this.normalizeTicketClaims(ticket);\n  }\n\n  // ============================================================================\n  // XSTS Token Methods\n  // ============================================================================\n\n  /**\n   * Requests an XSTS authorization token.\n   *\n   * @param userToken - The user token from requestUserToken.\n   * @param relyingParty - The relying party identifier.\n   * @param deviceToken - Optional device token for elevated permissions.\n   * @param titleToken - Optional title token for game-specific permissions.\n   * @param signal - Optional AbortSignal for cancellation.\n   * @returns The XSTS ticket, or null on failure.\n   */\n  async requestXstsToken(\n    userToken: string,\n    relyingParty = XboxEndpoints.XboxLiveRelyingParty,\n    deviceToken?: string,\n    titleToken?: string,\n    signal?: AbortSignal\n  ): Promise<XboxTicket | null> {\n    const properties: XboxTicketProperties = {\n      UserTokens: [userToken],\n      SandboxId: DEFAULT_SANDBOX,\n    };\n\n    if (deviceToken !== undefined) {\n      properties.DeviceToken = deviceToken;\n    }\n\n    if (titleToken !== undefined) {\n      properties.TitleToken = titleToken;\n    }\n\n    const request: XboxTicketRequest = {\n      RelyingParty: relyingParty,\n      TokenType: DEFAULT_TOKEN_TYPE,\n      Properties: properties,\n    };\n\n    const response = await this.fetchFn(XboxEndpoints.XboxLiveXstsAuthorize, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-xbl-contract-version': CONTRACT_VERSION_V1,\n        Accept: 'application/json',\n      },\n      body: JSON.stringify(request),\n      signal,\n    });\n\n    if (!response.ok) {\n      return null;\n    }\n\n    const ticket = (await response.json()) as XboxTicket;\n    return this.normalizeTicketClaims(ticket);\n  }\n\n  // ============================================================================\n  // SISU Methods\n  // ============================================================================\n\n  /**\n   * Initiates a SISU authentication session.\n   *\n   * @param appId - The application ID.\n   * @param titleId - The title ID.\n   * @param deviceToken - The device token from requestDeviceToken.\n   * @param offers - List of offer identifiers.\n   * @param redirectUri - The redirect URI for OAuth.\n   * @param tokenType - Token type (typically 'code').\n   * @param sandbox - Sandbox identifier.\n   * @param signal - Optional AbortSignal for cancellation.\n   * @returns The SISU authentication response with OAuth redirect URL, or null on failure.\n   */\n  async requestSISUSession(\n    appId: string,\n    titleId: string,\n    deviceToken: string,\n    offers: string[],\n    redirectUri: string,\n    tokenType = 'code',\n    sandbox = DEFAULT_SANDBOX,\n    signal?: AbortSignal\n  ): Promise<SISUAuthenticationResponse | null> {\n    const proofKey = await this.popCryptoProvider.getProofKey();\n    const state = webcrypto.randomUUID();\n\n    const request: XboxTicketRequest = {\n      AppId: appId,\n      TitleId: titleId,\n      DeviceToken: deviceToken,\n      Offers: offers,\n      ProofKey: proofKey,\n      RedirectUri: redirectUri,\n      Sandbox: sandbox,\n      TokenType: tokenType,\n      Query: {\n        display: 'touch',\n        code_challenge: this.codeChallenge,\n        code_challenge_method: 'S256',\n        state: state,\n      },\n    };\n\n    const body = JSON.stringify(request);\n    const signature = await this.signRequest(\n      XboxEndpoints.XboxLiveSisuAuthenticate,\n      '',\n      body\n    );\n\n    const response = await this.fetchFn(XboxEndpoints.XboxLiveSisuAuthenticate, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        Signature: signature,\n        'x-xbl-contract-version': CONTRACT_VERSION_V2,\n      },\n      body,\n      signal,\n    });\n\n    if (!response.ok) {\n      return null;\n    }\n\n    const authResponse = (await response.json()) as SISUAuthenticationResponse;\n\n    // Extract session ID from response header\n    const sessionId = response.headers.get('X-SessionId');\n    if (sessionId !== null) {\n      authResponse.SessionId = sessionId;\n    }\n\n    return authResponse;\n  }\n\n  /**\n   * Exchanges SISU session for authentication tokens.\n   *\n   * @param deviceToken - The device token.\n   * @param accessToken - The OAuth access token.\n   * @param appId - The application ID.\n   * @param sessionId - The session ID from requestSISUSession.\n   * @param sandbox - Sandbox identifier.\n   * @param siteName - Site name for authentication.\n   * @param useModernGamertag - Whether to use modern gamertag format.\n   * @param signal - Optional AbortSignal for cancellation.\n   * @returns The SISU authorization response with tokens, or error info on failure.\n   */\n  async requestSISUTokens(\n    deviceToken: string,\n    accessToken: string,\n    appId: string,\n    sessionId?: string,\n    sandbox = DEFAULT_SANDBOX,\n    siteName = 'user.auth.xboxlive.com',\n    useModernGamertag = true,\n    signal?: AbortSignal\n  ): Promise<SISUAuthorizationResponse> {\n    const proofKey = await this.popCryptoProvider.getProofKey();\n\n    const request: XboxTicketRequest = {\n      AppId: appId,\n      DeviceToken: deviceToken,\n      ProofKey: proofKey,\n      Sandbox: sandbox,\n      AccessToken: `t=${accessToken}`,\n      UseModernGamertag: useModernGamertag,\n      SiteName: siteName,\n    };\n\n    if (sessionId !== undefined) {\n      request.SessionId = sessionId;\n    }\n\n    const body = JSON.stringify(request);\n    const signature = await this.signRequest(\n      XboxEndpoints.XboxLiveSisuAuthorize,\n      '',\n      body\n    );\n\n    const response = await this.fetchFn(XboxEndpoints.XboxLiveSisuAuthorize, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        Signature: signature,\n        'x-xbl-contract-version': CONTRACT_VERSION_V2,\n      },\n      body,\n      signal,\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      return {\n        ErrorCode: response.status,\n        ErrorMessage: errorText,\n      };\n    }\n\n    const authzResponse = (await response.json()) as SISUAuthorizationResponse;\n\n    // Normalize display claims in nested tickets\n    if (authzResponse.UserToken !== undefined) {\n      authzResponse.UserToken = this.normalizeTicketClaims(authzResponse.UserToken);\n    }\n    if (authzResponse.TitleToken !== undefined) {\n      authzResponse.TitleToken = this.normalizeTicketClaims(authzResponse.TitleToken);\n    }\n    if (authzResponse.AuthorizationToken !== undefined) {\n      authzResponse.AuthorizationToken = this.normalizeTicketClaims(authzResponse.AuthorizationToken);\n    }\n\n    return authzResponse;\n  }\n\n  // ============================================================================\n  // Request Signing\n  // ============================================================================\n\n  /**\n   * Signs a request for Proof-of-Possession authentication.\n   *\n   * @param uri - The request URI.\n   * @param authToken - The authorization token (empty string if none).\n   * @param body - The request body.\n   * @returns The Base64-encoded signature header value.\n   */\n  private async signRequest(uri: string, authToken: string, body: string): Promise<string> {\n    const timestamp = this.getWindowsTimestamp();\n    const payload = this.generateSigningPayload(timestamp, uri, authToken, body);\n    const signature = await this.popCryptoProvider.sign(payload);\n\n    // Build final header: [policy version (4B)] + [timestamp (8B)] + [signature]\n    const header = new Uint8Array(12 + signature.length);\n    const view = new DataView(header.buffer);\n    view.setUint32(0, SIGNING_POLICY_VERSION, false); // big-endian\n    view.setBigUint64(4, timestamp, false); // big-endian\n    header.set(signature, 12);\n\n    return base64Encode(header);\n  }\n\n  /**\n   * Generates the signing payload for Proof-of-Possession.\n   *\n   * @param timestamp - Windows FILETIME timestamp.\n   * @param uri - Request URI.\n   * @param authToken - Authorization token.\n   * @param body - Request body.\n   * @returns The payload to sign.\n   */\n  private generateSigningPayload(\n    timestamp: bigint,\n    uri: string,\n    authToken: string,\n    body: string\n  ): Uint8Array {\n    const encoder = new TextEncoder();\n    const url = new URL(uri);\n    const pathAndQuery = url.pathname + url.search;\n\n    // Build payload:\n    // [policy version (4B BE)] + [0x00] +\n    // [timestamp (8B BE)] + [0x00] +\n    // \"POST\\0\" + pathAndQuery + \"\\0\" + authToken + \"\\0\" + body + \"\\0\"\n    const policyVersionBytes = new Uint8Array(4);\n    new DataView(policyVersionBytes.buffer).setUint32(0, SIGNING_POLICY_VERSION, false);\n\n    const timestampBytes = new Uint8Array(8);\n    new DataView(timestampBytes.buffer).setBigUint64(0, timestamp, false);\n\n    const textPart = encoder.encode(`POST\\0${pathAndQuery}\\0${authToken}\\0${body}\\0`);\n\n    const payload = new Uint8Array(\n      policyVersionBytes.length + 1 + timestampBytes.length + 1 + textPart.length\n    );\n\n    let offset = 0;\n    payload.set(policyVersionBytes, offset);\n    offset += policyVersionBytes.length;\n    payload[offset++] = 0x00;\n    payload.set(timestampBytes, offset);\n    offset += timestampBytes.length;\n    payload[offset++] = 0x00;\n    payload.set(textPart, offset);\n\n    return payload;\n  }\n\n  /**\n   * Gets the current time as a Windows FILETIME timestamp.\n   * FILETIME is 100-nanosecond intervals since January 1, 1601.\n   *\n   * @returns The timestamp as a bigint.\n   */\n  private getWindowsTimestamp(): bigint {\n    const unixSeconds = BigInt(Math.floor(Date.now() / 1000));\n    // Convert Unix epoch (1970-01-01) to Windows FILETIME epoch (1601-01-01)\n    // Offset: 11644473600 seconds\n    // Resolution: 100-nanosecond units (multiply by 10,000,000)\n    return (unixSeconds + 11644473600n) * 10000000n;\n  }\n\n  // ============================================================================\n  // PKCE Utilities\n  // ============================================================================\n\n  /**\n   * Generates a PKCE code verifier.\n   * Creates a 32-byte random value and Base64URL encodes it.\n   *\n   * @returns The code verifier string.\n   */\n  private generateCodeVerifier(): string {\n    const bytes = randomBytes(32);\n    return base64UrlEncode(new Uint8Array(bytes));\n  }\n\n  /**\n   * Generates a PKCE code challenge from a verifier.\n   * Computes SHA-256 hash of the verifier and Base64URL encodes it.\n   *\n   * @param verifier - The code verifier.\n   * @returns The code challenge string.\n   */\n  private generateCodeChallenge(verifier: string): string {\n    const hash = createHash('sha256').update(verifier).digest();\n    return base64UrlEncode(new Uint8Array(hash));\n  }\n\n  // ============================================================================\n  // Utilities\n  // ============================================================================\n\n  /**\n   * Normalizes ticket display claims to ensure xui is always an array.\n   *\n   * @param ticket - The ticket to normalize.\n   * @returns The ticket with normalized claims.\n   */\n  private normalizeTicketClaims(ticket: XboxTicket): XboxTicket {\n    if (ticket.DisplayClaims !== undefined) {\n      const claims = ticket.DisplayClaims as XboxDisplayClaims & { xui?: unknown };\n      if (claims.xui !== undefined) {\n        ticket.DisplayClaims = {\n          ...claims,\n          xui: normalizeToArray(claims.xui),\n        } as XboxDisplayClaims;\n      }\n    }\n    return ticket;\n  }\n}\n","/**\n * Represents an OAuth 2.0 token response from Microsoft identity services.\n */\nexport interface OAuthToken {\n  /**\n   * The type of token (typically 'bearer').\n   */\n  token_type?: string;\n\n  /**\n   * Number of seconds until the access token expires.\n   */\n  expires_in?: number;\n\n  /**\n   * The scope of access granted by the token.\n   */\n  scope?: string;\n\n  /**\n   * The access token used for authentication.\n   */\n  access_token?: string;\n\n  /**\n   * The refresh token used to obtain new access tokens.\n   */\n  refresh_token?: string;\n\n  /**\n   * The user identifier associated with the token.\n   */\n  user_id?: string;\n}\n\n/**\n * Type guard to check if an object is a valid OAuthToken with an access token.\n */\nexport function hasAccessToken(token: OAuthToken): token is OAuthToken & { access_token: string } {\n  return typeof token.access_token === 'string' && token.access_token.length > 0;\n}\n\n/**\n * Type guard to check if an object is a valid OAuthToken with a refresh token.\n */\nexport function hasRefreshToken(token: OAuthToken): token is OAuthToken & { refresh_token: string } {\n  return typeof token.refresh_token === 'string' && token.refresh_token.length > 0;\n}\n","import type { XboxDisplayClaims } from './xbox-display-claims.js';\n\nexport type { XboxDisplayClaims } from './xbox-display-claims.js';\n\n/**\n * Represents an Xbox authentication ticket (token response).\n */\nexport interface XboxTicket {\n  /**\n   * When the token was issued (ISO 8601 timestamp).\n   */\n  IssueInstant?: string;\n\n  /**\n   * When the token expires (ISO 8601 timestamp).\n   */\n  NotAfter?: string;\n\n  /**\n   * The actual token value.\n   */\n  Token?: string;\n\n  /**\n   * Claims associated with the token.\n   */\n  DisplayClaims?: XboxDisplayClaims;\n}\n\n/**\n * Type guard to check if an XboxTicket has a valid token.\n */\nexport function hasToken(ticket: XboxTicket | null | undefined): ticket is XboxTicket & { Token: string } {\n  return ticket !== null && ticket !== undefined && typeof ticket.Token === 'string' && ticket.Token.length > 0;\n}\n\n/**\n * Extracts the user hash from an Xbox ticket's display claims.\n * @param ticket - The Xbox ticket to extract from.\n * @returns The user hash, or undefined if not present.\n */\nexport function getUserHash(ticket: XboxTicket | null | undefined): string | undefined {\n  return ticket?.DisplayClaims?.xui?.[0]?.uhs;\n}\n","import type { XboxTicket } from './xbox-ticket.js';\n\n/**\n * MSA request parameters placeholder for SISU authentication.\n */\nexport interface MSARequestParameters {\n  // Reserved for future use\n}\n\n/**\n * Response from SISU authentication (session initialization).\n */\nexport interface SISUAuthenticationResponse {\n  /**\n   * The OAuth redirect URL for user authentication.\n   */\n  MsaOauthRedirect?: string;\n\n  /**\n   * Additional MSA request parameters.\n   */\n  MsaRequestParameters?: MSARequestParameters;\n\n  /**\n   * Session ID (extracted from X-SessionId response header).\n   */\n  SessionId?: string;\n}\n\n/**\n * Response from SISU authorization (token acquisition).\n */\nexport interface SISUAuthorizationResponse {\n  /**\n   * Device token.\n   */\n  DeviceToken?: string;\n\n  /**\n   * Title token.\n   */\n  TitleToken?: XboxTicket;\n\n  /**\n   * User token.\n   */\n  UserToken?: XboxTicket;\n\n  /**\n   * Authorization (XSTS) token.\n   */\n  AuthorizationToken?: XboxTicket;\n\n  /**\n   * Web page URL (for additional authentication steps).\n   */\n  WebPage?: string;\n\n  /**\n   * Sandbox identifier.\n   */\n  Sandbox?: string;\n\n  /**\n   * Whether modern gamertag is used.\n   */\n  UseModernGamertag?: boolean;\n\n  /**\n   * Authentication flow type.\n   */\n  Flow?: string;\n\n  /**\n   * Error code (HTTP status code on failure).\n   */\n  ErrorCode?: number;\n\n  /**\n   * Error message on failure.\n   */\n  ErrorMessage?: string;\n}\n\n/**\n * Type guard to check if a SISU authorization response indicates success.\n */\nexport function isSISUAuthorizationSuccess(\n  response: SISUAuthorizationResponse\n): response is SISUAuthorizationResponse & { AuthorizationToken: XboxTicket } {\n  return response.AuthorizationToken !== undefined && response.ErrorCode === undefined;\n}\n\n/**\n * Type guard to check if a SISU authorization response indicates failure.\n */\nexport function isSISUAuthorizationError(\n  response: SISUAuthorizationResponse\n): response is SISUAuthorizationResponse & { ErrorCode: number; ErrorMessage: string } {\n  return response.ErrorCode !== undefined && response.ErrorMessage !== undefined;\n}\n"]}